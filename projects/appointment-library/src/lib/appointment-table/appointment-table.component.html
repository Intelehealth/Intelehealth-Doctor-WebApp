<div class="row mt-3">
  <div class="col-md-12 p-0">
    <div class="text-right my-2">
      <mat-accordion
        class="intel-accordion-con"
        multi
        data-test-id="matAccAppointment"
      >
        <mat-expansion-panel [expanded]="true" data-test-id="matExpAppointment">
          <mat-expansion-panel-header data-test-id="matExpHeaderAppointment">
            <mat-panel-title>
              <div id="anchor-appointment" class="anchor-con"></div>
              <div class="intel-accordion-title">
                <img src="assets/svgs/cam-icon.svg" alt="" width="44px" />
                <h6 class="mb-0 ml-2">
                  {{ pluginConfig.tableHeader }} ({{ appointmentVisitsCount }})
                </h6>
                <mat-icon
                  aria-hidden="false"
                  aria-label="help icon"
                  matTooltip="{{ 'Scheduled appointments' }}"
                  matTooltipPosition="right"
                  data-test-id="matIcoHelpAppointment"
                  >help_outline</mat-icon
                >
                <div
                  class="input-group search-bar ml-auto"
                  (click)="$event.stopPropagation()"
                >
                  <input
                    type="text"
                    #apSearchInput
                    class="form-control"
                    placeholder="{{ pluginConfig.searchPlaceHolder }}"
                    aria-label="search1"
                    aria-describedby="basic-addon1"
                    (keyup)="applyFilter($event)"
                    (keydown.Space)="$event.stopPropagation()"
                    (keydown.Enter)="$event.stopPropagation()"
                    data-test-id="etSearchAppointmentDashboard"
                  />
                  <div class="input-group-append">
                    <span
                      class="input-group-text"
                      id="basic-addon1"
                      *ngIf="!tblDataSource.filter"
                    >
                      <img
                        src="assets/svgs/search-icon.svg"
                        alt=""
                        width="20px"
                        height="20px"
                      />
                    </span>
                    <button
                      data-test-id="btnResetApSerach"
                      class="matIconButton ml-0"
                      mat-icon-button
                      aria-label="Reset appointment search"
                      *ngIf="tblDataSource.filter"
                      (click)="clearFilter('Appointment')"
                    >
                      <mat-icon class="ml-0" style="line-height: normal"
                        >close</mat-icon
                      >
                    </button>
                  </div>
                </div>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <!-- <div>
            <h1>{{ tableHeaders }}</h1>
            <ul>
              <li *ngFor="let column of appointmentsColumns">
                {{ column.label }} - {{ column.key }}
              </li>
            </ul>
          </div> -->
          <div class="mat-elevation-z8">
            <table mat-table [dataSource]="tblDataSource">
              <!-- Define all columns dynamically -->
              <ng-container
                *ngFor="let column of appointmentsColumns"
                [matColumnDef]="column.key"
              >
                <th mat-header-cell *matHeaderCellDef>
                  {{ column.label }}
                </th>
                <td
                  mat-cell
                  *matCellDef="let element; let j = index"
                  [attr.data-test-id]="'apAge' + j"
                  [routerLink]="[
                    '/dashboard/visit-summary',
                    element?.visitUuid
                  ]"
                >
                  <ng-container [ngSwitch]="column.key">
                    <div
                      *ngSwitchCase="'name'"
                      class="d-flex align-items-center"
                    >
                      <img
                        src="assets/svgs/user.svg"
                        alt=""
                        width="32px"
                        height="32px"
                        style="border-radius: 50%"
                      />
                      <span class="font-bold ml-2">
                        {{ element.patientName }} ({{ element.patientGender }})
                      </span>
                    </div>
                    <span *ngSwitchCase="'age'">{{ element.patientAge }}y</span>
                    <span
                      *ngSwitchCase="'starts_in'"
                      [ngClass]="{
                        'alert-danger': element.starts_in.includes('Due'),
                        'alert-success':
                          element.starts_in.includes('Hour') ||
                          element.starts_in.includes('Minute')
                      }"
                      >{{ element.starts_in }}</span
                    >
                    <span *ngSwitchCase="'location'">{{
                      element?.visit?.location?.name
                    }}</span>
                    <span *ngSwitchCase="'cheif_complaint'">{{
                      element.cheif_complaint
                    }}</span>
                    <a
                      *ngSwitchCase="'telephone'"
                      href="{{ element.telephone }}"
                      target="_blank"
                    >
                      <img src="assets/svgs/whatsapp-green.svg" alt="" />
                    </a>
                    <div
                      *ngSwitchCase="'actions'"
                      class="actions-btn-wrap d-flex align-items-center"
                    >
                      <button
                        class="action-btn blue-btn mr-2"
                        type="button"
                        (click)="reschedule(element)"
                      >
                        Reschedule
                      </button>
                      <button
                        class="action-btn pink-btn"
                        type="button"
                        (click)="cancel(element)"
                      >
                        Cancel
                      </button>
                    </div>
                  </ng-container>
                </td>
              </ng-container>

              <!-- Row Definitions -->
              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

              <!-- No Data Row -->
              <tr class="mat-row" *matNoDataRow>
                <td
                  class="mat-cell text-center"
                  [attr.colspan]="appointmentsColumns.length"
                >
                  No appointments scheduled.
                </td>
              </tr>
            </table>
            <mat-paginator
              #tempPaginator
              hidePageSize
              [pageSizeOptions]="[5, 10, 20]"
              aria-label="Select page of periodic elements"
            ></mat-paginator>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>
