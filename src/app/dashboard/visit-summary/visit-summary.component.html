<div class="container-fluid">
  <div class="row">
    <div class="col-md-12 p-0 mb-5" *ngIf="visitAppointment">
      <div class="appointment-banner">
        <div>
          <h6>Appointment starts in</h6>
          <p>
            <img src="assets/svgs/clock-green.svg" alt="">
            {{ checkIfDateOldThanOneDay(visitAppointment) }}
          </p>
        </div>
        <div>
          <button type="button" class="start-call-btn">Start call</button>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 mb-5">
      <div class="intel-card">
        <div class="card-body">
          <div class="row patient-info-wrapper" *ngIf="patient">
            <div class="col-md-4 patient-info-section p-3">
              <div class="patient-img-item mb-2">
                <div class="patient-img">
                  <img src="{{ baseUrl + '/personimage/' + patient?.person.uuid }}" (error) ="onImgError($event)" alt="" width="100%" height="100%">
                </div>
                <div class="ml-3">
                  <h6>{{patient?.person.display}} ({{patient?.person.gender}})</h6>
                  <p>{{getPatientIdentifier('OpenMRS ID')}}</p>
                </div>
              </div>
              <div class="patient-info-item">
                <h6>Age</h6>
                <p>{{ (patient?.person.birthdate) ? getAge(patient?.person.birthdate) : patient?.person.age }}</p>
              </div>
            </div>
            <div class="col-md-4 patient-info-section p-3">
              <div class="patient-info-item mb-3">
                <h6>Occupation</h6>
                <p>{{getPersonAttributeValue('occupation')}}</p>
              </div>
              <div class="patient-info-item">
                <h6>Address</h6>
                <p>{{patient?.person.preferredAddress.cityVillage}}</p>
              </div>
            </div>
            <div class="col-md-4 patient-info-section p-3">
              <div class="patient-info-item">
                <h6>Contact no.</h6>
                <p>
                  {{getPersonAttributeValue('Telephone Number')}}
                  <a href="{{getWhatsAppLink()}}" target="_blank" class="icon-btn">
                    <img src="assets/svgs/whatsapp-icon.svg" alt="">
                  </a>
                </p>
                <p>
                  {{getPersonAttributeValue('Telephone Number')}}
                  <a href="tel:{{getPersonAttributeValue('Telephone Number')}}" target="_blank" class="icon-btn">
                    <img src="assets/svgs/phone-circle.svg" alt="">
                  </a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 mb-5">
      <div class="intel-card">
        <mat-tab-group mat-align-tabs="start" [disableRipple]="true" (selectedIndexChange)="onTabChange($event)">
          <mat-tab label="Current visit summary">
            <div class="text-right">
              <button *ngIf="!showAll" mat-button (click)="accordion.openAll(); showAll=!showAll"><span class="text-muted">Show all</span> <mat-icon>expand_more</mat-icon> </button>
              <button *ngIf="showAll" mat-button (click)="accordion.closeAll(); showAll=!showAll"><span class="text-muted">Hide all</span> <mat-icon>expand_less</mat-icon></button>
            </div>
            <mat-accordion class="intel-accordion-con" multi>
              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/consultation-details.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Consultation details</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ul class="items-list">
                  <li>
                    <div class="list-item">
                      <label>Visit ID</label>
                      <div class="list-item-content">
                        {{(visit?.uuid)?(replaceWithStar(visit?.uuid)|uppercase):''}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Visit created</label>
                      <div class="list-item-content">
                        {{visit?.startDatetime|date: 'dd MMM, yyyy'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Appointment on</label>
                      <div class="list-item-content">
                        <span [class.text-muted]="!visitAppointment">{{(visitAppointment)?(visitAppointment|date:'dd MMM, yyyy'):'No appointment' }}</span>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Status</label>
                      <div class="list-item-content">
                        <span [ngClass]="{ 'text-important-red': visitStatus == 'Priority Visit', 'text-important-green': ['Awaiting Visit', 'In-progress Visit', 'Completed Visit', 'Ended Visit'].indexOf(visitStatus) != -1 }">{{visitStatus}}</span>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Location</label>
                      <div class="list-item-content">
                        {{clinicName|titlecase}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Provided by</label>
                      <div class="list-item-content">
                        <div class="visit-provider-con">
                          <span>{{providerName}}</span>
                          <div>
                            <img class="mx-3" src="assets/svgs/dot.svg" />
                            <a href="javascript:void(0)" class="icon-btn" (click)="startChat()">
                              <img src="assets/svgs/whatsapp-icon.svg" alt="">
                            </a>
                            <a href="javascript:void(0)" class="icon-btn" (click)="startCall()">
                              <img src="assets/svgs/phone-circle.svg" alt="">
                            </a>
                          </div>
                          <span class="text-muted">Click here to connent with CHW</span>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>

              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true" class="bg-gray">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/vitals.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Vitals</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ul class="items-list">
                  <li>
                    <div class="list-item">
                      <label>Height (cm)</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('Height (cm)')">
                        {{(getObsValue('Height (cm)'))?getObsValue('Height (cm)'):'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Weight (kg)</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('Weight (kg)')">
                        {{(getObsValue('Weight (kg)'))?getObsValue('Weight (kg)'):'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>BMI</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('Height (cm)') || !getObsValue('Weight (kg)')">
                        {{(getObsValue('Height (cm)') && getObsValue('Weight (kg)'))? ((getObsValue('Weight (kg)')/((getObsValue('Height (cm)')/100)*(getObsValue('Height (cm)')/100)))|number:'1.2-2') :'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>BP</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('SYSTOLIC BLOOD PRESSURE')">
                        {{getObsValue('SYSTOLIC BLOOD PRESSURE') ? getObsValue('SYSTOLIC BLOOD PRESSURE') + ' / ' + getObsValue('DIASTOLIC BLOOD PRESSURE') : 'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Pulse</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('Pulse')">
                        {{(getObsValue('Pulse'))?getObsValue('Pulse'):'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Temprature (F)</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('TEMP')">
                        {{(getObsValue('TEMP'))?getObsValue('TEMP'):'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>SpO2 (%)</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('BLOOD OXYGEN SATURATION')">
                        {{(getObsValue('BLOOD OXYGEN SATURATION'))?getObsValue('BLOOD OXYGEN SATURATION'):'No information'}}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Respiratory Rate</label>
                      <div class="list-item-content" [class.text-muted]="!getObsValue('Respiratory rate')">
                        {{(getObsValue('Respiratory rate'))?getObsValue('Respiratory rate'):'No information'}}
                      </div>
                    </div>
                  </li>
                </ul>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/check-up-reason.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Check-up reason</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <div class="cheif-complaint-wrapper">
                  <h6>Cheif Complaint</h6>
                  <div class="complaint-chips">
                    <div class="chip-item" *ngFor="let c of cheifComplaints;">
                      {{c}}
                    </div>
                  </div>
                  <div class="check-up-reason-con">
                    <ng-container *ngFor="let ckr of checkUpReasonData;">
                      <ng-container *ngIf="ckr.title != 'Associated symptoms'">
                        <h6 class="my-3">{{ckr.title}}</h6>
                        <ul class="items-list pt-0">
                          <li *ngFor="let ckri of ckr.data">
                            <div class="list-item">
                              <label>{{ckri.key}}</label>
                              <div class="list-item-content" [class.text-muted]="!ckri.value">
                                {{(ckri.value)?ckri.value:'None'}}
                              </div>
                            </div>
                          </li>
                        </ul>
                      </ng-container>
                      <ng-container *ngIf="ckr.title == 'Associated symptoms'">
                        <h6 class="my-3">{{ckr.title}}</h6>
                        <ul class="items-list pt-0">
                          <li *ngFor="let ckri of ckr.data">
                            <div class="list-item-col">
                              <label>{{ckri.key}}</label>
                              <div class="list-item-content" [class.text-muted]="!ckri.value">
                                {{(ckri.value)?ckri.value:'None'}}
                              </div>
                            </div>
                          </li>
                        </ul>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true" class="bg-gray">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/physical-examination.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Physical examination</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ng-container *ngFor="let pe of physicalExaminationData;">
                  <div class="cheif-complaint-wrapper">
                    <ng-container *ngIf="pe.title != 'Abdomen'">
                      <h6 class="my-3">{{pe.title}}</h6>
                      <ul class="items-list pt-0">
                        <li *ngFor="let pei of pe.data">
                          <div class="list-item">
                            <label>{{pei.key}}</label>
                            <div class="list-item-content" [class.text-muted]="!pei.value">
                              {{(pei.value)?pei.value:'None'}}
                            </div>
                          </div>
                        </li>
                        <li *ngIf="eyeImages.length">
                          <div class="list-item">
                            <label>Eye images</label>
                            <div class="list-item-content">
                              <div class="eye-images-con">
                                <div class="eye-item" *ngFor="let e of eyeImages;">
                                  <img [src]="e.src" alt="">
                                </div>
                              </div>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </ng-container>
                    <ng-container *ngIf="pe.title == 'Abdomen'">
                      <h6 class="my-3">{{pe.title}}</h6>
                      <ul class="items-list pt-0">
                        <li *ngFor="let pei of pe.data">
                          {{pei.key}}
                        </li>
                      </ul>
                    </ng-container>
                  </div>
                </ng-container>

              </mat-expansion-panel>
              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/medical-history.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Medical history</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ng-container *ngFor="let ph of patientHistoryData;">
                  <div class="cheif-complaint-wrapper">
                    <h6 class="my-3">{{ph.title}}</h6>
                    <ul class="items-list pt-0">
                      <li *ngFor="let phi of ph.data">
                        <div class="list-item">
                          <label>{{phi.key}}</label>
                          <div class="list-item-content" [class.text-muted]="!phi.value">
                            {{(phi.value)?phi.value:'None'}}
                          </div>
                        </div>
                      </li>
                    </ul>

                  </div>
                </ng-container>

              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true" class="bg-gray">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/additional-documents.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Additional documents</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ng-container *ngIf="additionalDocs.length; else noAdditionaDocs;">
                  <div class="additional-doc-container">
                    <div class="doc-item" *ngFor="let d of additionalDocs;">
                      <img [src]="d.src" alt="">
                    </div>
                    <div class="doc-item">
                      <div class="other-doc">
                        <img src="assets/svgs/pdf-doc.svg" alt="">
                        <span>Blood test report.pdf</span>
                      </div>
                    </div>
                  </div>
                </ng-container>

                <ng-template #noAdditionaDocs>
                  <div class="no-docs">
                    No additional docs available!
                  </div>
                </ng-template>

              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="!visitNotePresent" [disabled]="visitNotePresent">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/refer-specialist.svg" alt="" width="44px">
                      <h6 class="mb-0 ml-2">Refer to specialist</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <form [formGroup]="referSpecialityForm" (ngSubmit)="referSpecialist()" class="refer-form">
                  <div class="form-group row">
                    <label for="refer" class="col-sm-3 col-form-label">Refer to another speciality</label>
                    <div class="col-sm-9 d-flex align-items-center">
                      <div class="pretty p-default p-round">
                        <input type="radio" [value]="true" formControlName="refer"/>
                        <div class="state p-success">
                          <label>Yes</label>
                        </div>
                      </div>
                      <div class="pretty p-default p-round">
                        <input type="radio" [value]="false" formControlName="refer"/>
                        <div class="state p-success">
                          <label>No</label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="referSpecialityForm.value.refer">
                    <div class="form-group row">
                      <label for="refer" class="col-sm-3 col-form-label">Specialization</label>
                      <div class="col-sm-3">
                        <ng-select formControlName="specialization" [items]="specializations" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="true" placeholder="Select specialization">
                        </ng-select>
                      </div>
                    </div>
                    <div class="form-group">
                      <button type="submit" class="next-btn">Re-assign</button>
                    </div>
                  </ng-container>

                </form>
              </mat-expansion-panel>
            </mat-accordion>
          </mat-tab>

          <mat-tab label="Past visit history">

          </mat-tab>

        </mat-tab-group>
      </div>
    </div>

    <div class="col-md-12 p-0 mb-5">
      <div class="intel-card">
        <div class="card-body">
          <p class="note-con">
            <span class="important-text">Note:</span> This history note and physical exam note was generated by a community health worker with the support of the Intelehealth mobile application and Ayu, a digital assistant. It collects only preliminary findings and may not gather all of the patient's clinical information, especially sensitive information or complex physical exam information which is hard for the health worker to collect. Please verify crucial clinical information and collect any additional information you require by speaking with the patient directly.
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 py-2 mb-5 text-center" *ngIf="!visitNotePresent">
      <button type="button" class="blue-btn" (click)="startVisitNote()">Start visit note</button>
    </div>

    <div class="col-md-12 p-0 mb-5" *ngIf="visitNotePresent">
      <div class="intel-card">
        <div class="card-body">
          <mat-accordion class="intel-accordion-con">
            <mat-expansion-panel [expanded]="true">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/patient-interaction.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Patient interaction</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>
            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="false" class="bg-gray">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/diagnosis.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Diagnosis</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>
            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/note.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Note</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>
            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="false" class="bg-gray">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/medication.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Medication</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

            </mat-expansion-panel>
            <mat-expansion-panel [expanded]="false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/advice.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Advice</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="false" class="bg-gray">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/test.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Test</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/referral.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Referral</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="false" class="bg-gray">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/follow-up.svg" alt="" width="44px">
                    <h6 class="mb-0 ml-2">Follow-up</h6>
                  </div>
                </mat-panel-title>
              </mat-expansion-panel-header>

            </mat-expansion-panel>

          </mat-accordion>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 py-2 mb-5 text-center" *ngIf="visitNotePresent">
      <button type="button" class="blue-btn" >Share prescription</button>
    </div>
  </div>
</div>
