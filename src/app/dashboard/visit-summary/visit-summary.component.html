<div class="container-fluid">
  <div class="row">
    <div class="col-md-12 p-0 mb-5" *ngIf="visitAppointment">
      <div class="appointment-banner">
        <div>
          <h6>Appointment starts in</h6>
          <p>
            <img src="assets/svgs/clock-green.svg" alt="" />
            {{ checkIfDateOldThanOneDay(visitAppointment) }}
          </p>
        </div>
        <div>
          <a
            class="start-call-btn"
            href="tel:{{ getPersonAttributeValue('Telephone Number') }}"
            target="_blank"
          >
            Start call
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 mb-5">
      <div class="intel-card">
        <div class="card-body">
          <div class="row patient-info-wrapper" *ngIf="patient">
            <div class="col-md-4 patient-info-section p-3">
              <div class="patient-img-item mb-2">
                <div class="patient-img">
                  <img
                    src="{{ baseUrl + '/personimage/' + patient?.person.uuid }}"
                    (error)="onImgError($event)"
                    alt=""
                    width="100%"
                    height="100%"
                  />
                </div>
                <div class="ml-3">
                  <h6>
                    {{ patient?.person.display }} ({{ patient?.person.gender }})
                  </h6>
                  <p>{{ getPatientIdentifier("OpenMRS ID") }}</p>
                </div>
              </div>
              <div class="patient-info-item">
                <h6>Age</h6>
                <p>
                  {{
                    patient?.person.birthdate
                      ? getAge(patient?.person.birthdate)
                      : patient?.person.age
                  }}
                </p>
              </div>
            </div>
            <div class="col-md-4 patient-info-section p-3">
              <div class="patient-info-item mb-3">
                <h6>Occupation</h6>
                <p>{{ getPersonAttributeValue("occupation") }}</p>
              </div>
              <div class="patient-info-item">
                <h6>Address</h6>
                <p>{{ patient?.person.preferredAddress.cityVillage.replace(':',' : ') }}</p>
              </div>
            </div>
            <div class="col-md-4 patient-info-section p-3">
              <div class="patient-info-item">
                <h6>Contact no.</h6>
                <p  *ngIf="getPersonAttributeValue('Telephone Number') === 'NA'">
                   {{ getPersonAttributeValue("Telephone Number") }}
                </p>
                <p *ngIf="getPersonAttributeValue('Telephone Number') !== 'NA'">
                  {{ getPersonAttributeValue("Telephone Number") }}
                  <a
                    href="{{ getWhatsAppLink() }}"
                    target="_blank"
                    class="icon-btn"
                  >
                    <img src="assets/svgs/whatsapp-icon.svg" alt="" />
                  </a>
                </p>
                <p *ngIf="getPersonAttributeValue('Telephone Number') !== 'NA'">
                  {{ getPersonAttributeValue("Telephone Number") }}
                  <a
                    href="tel:{{ getPersonAttributeValue('Telephone Number') }}"
                    target="_blank"
                    class="icon-btn"
                  >
                    <img src="assets/svgs/phone-circle.svg" alt="" />
                  </a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 mb-5">
      <div class="intel-card">
        <mat-tab-group
          class="visit-summary-tab-group"
          mat-align-tabs="start"
          [disableRipple]="true"
          (selectedIndexChange)="onTabChange($event)"
        >
          <mat-tab label="Current visit summary">
            <div class="text-right">
              <button
                *ngIf="!showAll"
                mat-button
                (click)="accordion.openAll(); showAll = !showAll"
              >
                <span class="text-muted">Show all</span>
                <mat-icon>expand_more</mat-icon>
              </button>
              <button
                *ngIf="showAll"
                mat-button
                (click)="accordion.closeAll(); showAll = !showAll"
              >
                <span class="text-muted">Hide all</span>
                <mat-icon>expand_less</mat-icon>
              </button>
            </div>
            <mat-accordion class="intel-accordion-con" multi>
              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img
                        src="assets/svgs/consultation-details.svg"
                        alt=""
                        width="44px"
                      />
                      <h6 class="mb-0 ml-2">Consultation details</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ul class="items-list">
                  <li>
                    <div class="list-item">
                      <label>Visit ID</label>
                      <div class="list-item-content">
                        {{
                          visit?.uuid
                            ? (replaceWithStar(visit?.uuid) | uppercase)
                            : ""
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Visit created</label>
                      <div class="list-item-content">
                        {{ visit?.startDatetime | date : "dd MMM, yyyy" }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Appointment on</label>
                      <div class="list-item-content">
                        <span [class.text-muted]="!visitAppointment">{{
                          visitAppointment
                            ? (visitAppointment | date : "dd MMM, yyyy")
                            : "No appointment"
                        }}</span>
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Status</label>
                      <div class="list-item-content">
                        <span
                          [ngClass]="{
                            'text-important-red':
                              visitStatus == 'Priority Visit',
                            'text-important-green':
                              [
                                'Awaiting Visit',
                                'In-progress Visit',
                                'Completed Visit',
                                'Ended Visit'
                              ].indexOf(visitStatus) != -1
                          }"
                          >{{ visitStatus }}</span
                        >
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Location</label>
                      <div class="list-item-content">
                        {{ clinicName | titlecase }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Provided by</label>
                      <div class="list-item-content">
                        <div class="visit-provider-con">
                          <span>{{ providerName }}</span>
                          <!-- <div class="d-flex">
                            <img class="mx-3" src="assets/svgs/dot.svg" />
                            <a
                              href="javascript:void(0)"
                              class="icon-btn"
                              (click)="startChat()"
                            >
                              <img src="assets/svgs/msg.svg" alt="" />
                            </a>
                            <a
                              href="javascript:void(0)"
                              class="icon-btn"
                              (click)="startCall()"
                            >
                              <img src="assets/svgs/phone-circle.svg" alt="" />
                            </a>
                          </div>
                          <span class="text-muted"
                            >Click here to connent with CHW</span
                          > -->
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true" class="bg-gray">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img src="assets/svgs/vitals.svg" alt="" width="44px" />
                      <h6 class="mb-0 ml-2">Vitals</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ul class="items-list">
                  <li>
                    <div class="list-item">
                      <label>Height (cm)</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="!getObsValue('Height (cm)')"
                      >
                        {{
                          getObsValue("Height (cm)")
                            ? getObsValue("Height (cm)")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Weight (kg)</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="!getObsValue('Weight (kg)')"
                      >
                        {{
                          getObsValue("Weight (kg)")
                            ? getObsValue("Weight (kg)")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>BMI</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="
                          !getObsValue('Height (cm)') ||
                          !getObsValue('Weight (kg)')
                        "
                      >
                        {{
                          getObsValue("Height (cm)") &&
                          getObsValue("Weight (kg)")
                            ? (getObsValue("Weight (kg)") /
                                ((getObsValue("Height (cm)") / 100) *
                                  (getObsValue("Height (cm)") / 100))
                              | number : "1.2-2")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>BP</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="
                          !getObsValue('SYSTOLIC BLOOD PRESSURE')
                        "
                      >
                        {{
                          getObsValue("SYSTOLIC BLOOD PRESSURE")
                            ? getObsValue("SYSTOLIC BLOOD PRESSURE") +
                              " / " +
                              getObsValue("DIASTOLIC BLOOD PRESSURE")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Pulse</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="!getObsValue('Pulse')"
                      >
                        {{
                          getObsValue("Pulse")
                            ? getObsValue("Pulse")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Temprature (F)</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="!getObsValue('TEMPERATURE (C)')"
                      >
                        {{
                          getObsValue("TEMPERATURE (C)")
                            ? ((getObsValue("TEMPERATURE (C)") * 9) / 5 + 32
                              | number : "0.2-2")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>SpO2 (%)</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="
                          !getObsValue('BLOOD OXYGEN SATURATION')
                        "
                      >
                        {{
                          getObsValue("BLOOD OXYGEN SATURATION")
                            ? getObsValue("BLOOD OXYGEN SATURATION")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                  <li>
                    <div class="list-item">
                      <label>Respiratory Rate</label>
                      <div
                        class="list-item-content"
                        [class.text-muted]="!getObsValue('Respiratory rate')"
                      >
                        {{
                          getObsValue("Respiratory rate")
                            ? getObsValue("Respiratory rate")
                            : "No information"
                        }}
                      </div>
                    </div>
                  </li>
                </ul>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img
                        src="assets/svgs/check-up-reason.svg"
                        alt=""
                        width="44px"
                      />
                      <h6 class="mb-0 ml-2">Check-up reason</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <div class="cheif-complaint-wrapper">
                  <h6>Cheif Complaint</h6>
                  <div class="complaint-chips">
                    <div class="chip-item" *ngFor="let c of cheifComplaints">
                      {{ c }}
                    </div>
                  </div>
                  <div class="check-up-reason-con">
                    <ng-container *ngFor="let ckr of checkUpReasonData">
                      <ng-container *ngIf="ckr.title != 'Associated symptoms'">
                        <h6 class="my-3">{{ ckr.title }}</h6>
                        <ul class="items-list pt-0">
                          <li *ngFor="let ckri of ckr.data">
                            <div class="list-item">
                              <label>{{ ckri.key }}</label>
                              <div
                                class="list-item-content"
                                [class.text-muted]="!ckri.value"
                              >
                                {{ ckri.value ? ckri.value : "None" }}
                              </div>
                            </div>
                          </li>
                        </ul>
                      </ng-container>
                      <ng-container *ngIf="ckr.title == 'Associated symptoms'">
                        <h6 class="my-3">{{ ckr.title }}</h6>
                        <ul class="items-list pt-0">
                          <li *ngFor="let ckri of ckr.data">
                            <div class="list-item-col">
                              <label>{{ ckri.key }}</label>
                              <div
                                class="list-item-content"
                                [class.text-muted]="!ckri.value"
                              >
                                {{ ckri.value ? ckri.value : "None" }}
                              </div>
                            </div>
                          </li>
                        </ul>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true" class="bg-gray">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img
                        src="assets/svgs/physical-examination.svg"
                        alt=""
                        width="44px"
                      />
                      <h6 class="mb-0 ml-2">Physical examination</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ng-container *ngFor="let pe of physicalExaminationData">
                  <div class="cheif-complaint-wrapper">
                    <ng-container *ngIf="pe.title != 'Abdomen'">
                      <h6 class="my-3">{{ pe.title }}</h6>
                      <ul class="items-list pt-0">
                        <li *ngFor="let pei of pe.data">
                          <div class="list-item">
                            <label>{{ pei.key }}</label>
                            <div
                              class="list-item-content"
                              [class.text-muted]="!pei.value"
                            >
                              {{ pei.value ? pei.value : "None" }}
                            </div>
                          </div>
                        </li>
                        <li *ngIf="eyeImages.length">
                          <div class="list-item">
                            <label>Eye images</label>
                            <div class="list-item-content">
                              <div class="eye-images-con">
                                <div
                                  class="eye-item"
                                  *ngFor="let e of eyeImages; let x = index"
                                >
                                  <img [src]="e.src" alt="" />
                                  <div
                                    class="cover"
                                    (click)="previewEyeImages(x)"
                                  >
                                    <img
                                      src="assets/svgs/maximize.svg"
                                      alt=""
                                    />
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </ng-container>
                    <ng-container *ngIf="pe.title == 'Abdomen'">
                      <h6 class="my-3">{{ pe.title }}</h6>
                      <ul class="items-list pt-0">
                        <li *ngFor="let pei of pe.data">
                          {{ pei.key }}
                        </li>
                      </ul>
                    </ng-container>
                  </div>
                </ng-container>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img
                        src="assets/svgs/medical-history.svg"
                        alt=""
                        width="44px"
                      />
                      <h6 class="mb-0 ml-2">Medical history</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ng-container *ngFor="let ph of patientHistoryData">
                  <div class="cheif-complaint-wrapper">
                    <h6 class="my-3">{{ ph.title }}</h6>
                    <ul class="items-list pt-0">
                      <li *ngFor="let phi of ph.data">
                        <div class="list-item">
                          <label>{{ phi.key }}</label>
                          <div
                            class="list-item-content"
                            [class.text-muted]="!phi.value"
                          >
                            {{ phi.value ? phi.value : "None" }}
                          </div>
                        </div>
                      </li>
                    </ul>
                  </div>
                </ng-container>
              </mat-expansion-panel>

              <mat-expansion-panel [expanded]="true" class="bg-gray">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img
                        src="assets/svgs/additional-documents.svg"
                        alt=""
                        width="44px"
                      />
                      <h6 class="mb-0 ml-2">Additional documents</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <ng-container
                  *ngIf="additionalDocs.length; else noAdditionaDocs"
                >
                  <div class="additional-doc-container">
                    <div
                      class="doc-item"
                      *ngFor="let d of additionalDocs; let x = index"
                    >
                      <img [src]="d.src" alt="" />
                      <div class="cover" (click)="previewDocImages(x)">
                        <img src="assets/svgs/maximize.svg" alt="" />
                      </div>
                    </div>
                    <!-- <div class="doc-item">
                      <div class="other-doc">
                        <img src="assets/svgs/pdf-doc.svg" alt="">
                        <span>Blood test report.pdf</span>
                      </div>
                    </div> -->
                  </div>
                </ng-container>

                <ng-template #noAdditionaDocs>
                  <div class="no-docs">No additional docs available!</div>
                </ng-template>
              </mat-expansion-panel>

              <mat-expansion-panel
                [expanded]="!visitNotePresent"
                *ngIf="!visitNotePresent"
              >
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="intel-accordion-title">
                      <img
                        src="assets/svgs/refer-specialist.svg"
                        alt=""
                        width="44px"
                      />
                      <h6 class="mb-0 ml-2">Refer to specialist</h6>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>

                <form
                  [formGroup]="referSpecialityForm"
                  (ngSubmit)="referSpecialist()"
                  class="refer-form"
                >
                  <div class="form-group row">
                    <label for="refer" class="col-sm-3 col-form-label"
                      >Refer to another speciality</label
                    >
                    <div class="col-sm-9 d-flex align-items-center">
                      <div class="pretty p-default p-round">
                        <input
                          type="radio"
                          [value]="true"
                          formControlName="refer"
                        />
                        <div class="state p-success">
                          <label>Yes</label>
                        </div>
                      </div>
                      <div class="pretty p-default p-round">
                        <input
                          type="radio"
                          [value]="false"
                          formControlName="refer"
                        />
                        <div class="state p-success">
                          <label>No</label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="referSpecialityForm.value.refer">
                    <div class="form-group row">
                      <label for="refer" class="col-sm-3 col-form-label"
                        >Specialization</label
                      >
                      <div class="col-sm-3">
                        <ng-select
                          appendTo=".visit-summary-tab-group"
                          class="visit-select"
                          formControlName="specialization"
                          [items]="specializations"
                          bindLabel="name"
                          bindValue="name"
                          [clearable]="false"
                          [searchable]="true"
                          placeholder="Select specialization"
                        >
                        </ng-select>
                      </div>
                    </div>
                    <div class="form-group">
                      <button type="submit" class="next-btn">Re-assign</button>
                    </div>
                  </ng-container>
                </form>
              </mat-expansion-panel>
            </mat-accordion>
          </mat-tab>

          <mat-tab label="Past visit history">
            <div class="mat-elevation-z8">
              <table mat-table [dataSource]="dataSource">
                <!-- Action Column -->
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef></th>
                  <td mat-cell *matCellDef="let element; let first = first">
                    <div class="timeline-icon">
                      <div class="t-line" *ngIf="!first"></div>
                      <div class="dot"></div>
                      <div class="b-line"></div>
                    </div>
                  </td>
                </ng-container>

                <!-- Created on Column -->
                <ng-container matColumnDef="created_on">
                  <th mat-header-cell *matHeaderCellDef>Created on</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.created_on | date : "dd MM, yyyy" }}
                  </td>
                </ng-container>

                <!-- Consulted by Column -->
                <ng-container matColumnDef="consulted_by">
                  <th mat-header-cell *matHeaderCellDef>Consulted by</th>
                  <td mat-cell *matCellDef="let element">
                    <div
                      class="d-flex align-items-center"
                      *ngIf="element.doctor"
                    >
                      <img
                        src="{{
                          baseUrl +
                            '/personimage/' +
                            element?.doctor?.person_uuid
                        }}"
                        (error)="onImgError($event)"
                        alt=""
                        width="32px"
                        height="32px"
                        style="border-radius: 50%"
                      />
                      <span class="font-bold ml-2"
                        >{{ element?.doctor?.name }} ({{
                          element?.doctor?.gender
                        }})</span
                      >
                    </div>
                  </td>
                </ng-container>

                <!-- Cheif Complaint Column -->
                <ng-container matColumnDef="cheif_complaint">
                  <th mat-header-cell *matHeaderCellDef>Cheif Complaint</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.cheif_complaint }}
                  </td>
                </ng-container>

                <!-- Summary Column -->
                <ng-container matColumnDef="summary">
                  <th mat-header-cell *matHeaderCellDef>Summary</th>
                  <td mat-cell *matCellDef="let element">
                    <a
                      class="pill-anchor"
                      href="javascript:void(0)"
                      (click)="openVisitSummaryModal(element.uuid)"
                    >
                      <div class="blue-pill">
                        <img
                          src="assets/svgs/summary-list-blue-icon.svg"
                          alt=""
                        />
                        <span class="ml-1">View</span>
                      </div>
                    </a>
                  </td>
                </ng-container>

                <!-- Prescription Column -->
                <ng-container matColumnDef="prescription">
                  <th mat-header-cell *matHeaderCellDef>Prescription</th>
                  <td mat-cell *matCellDef="let element">
                    <a
                      *ngIf="element.prescription_sent"
                      class="pill-anchor"
                      href="javascript:void(0)"
                      (click)="openVisitPrescriptionModal(element.uuid)"
                    >
                      <div class="green-pill">
                        <img src="assets/svgs/green-pad.svg" alt="" />
                        <span class="ml-1">View</span>
                      </div>
                    </a>
                  </td>
                </ng-container>

                <!-- Prescription sent Column -->
                <ng-container matColumnDef="prescription_sent">
                  <th mat-header-cell *matHeaderCellDef>Prescription sent</th>
                  <td mat-cell *matCellDef="let element">
                    <div class="blue-pill" *ngIf="element.prescription_sent">
                      <img src="assets/svgs/pad-4.svg" alt="" />
                      <span class="ml-1">{{ element.prescription_sent }}</span>
                    </div>
                  </td>
                </ng-container>

                <tr class="mat-row" *matNoDataRow>
                  <td
                    class="mat-cell text-center"
                    [attr.colspan]="displayedColumns.length"
                  >
                    No past visit history
                  </td>
                </tr>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumns"
                ></tr>
              </table>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>

    <div class="col-md-12 p-0 mb-5">
      <div class="intel-card">
        <div class="card-body">
          <p class="note-con">
            <span class="important-text">Note:</span> This history note and
            physical exam note was generated by a community health worker with
            the support of the Intelehealth mobile application and Ayu, a
            digital assistant. It collects only preliminary findings and may not
            gather all of the patient's clinical information, especially
            sensitive information or complex physical exam information which is
            hard for the health worker to collect. Please verify crucial
            clinical information and collect any additional information you
            require by speaking with the patient directly.
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 py-2 mb-5 text-center" *ngIf="!visitNotePresent && !visitCompleted && !visitEnded">
      <button type="button" class="blue-btn" (click)="startVisitNote()">
        Start visit note
      </button>
    </div>

    <div class="col-md-12 p-0 mb-5" *ngIf="visitNotePresent">
      <div class="intel-card">
        <div class="card-body">
          <mat-accordion class="intel-accordion-con" multi>
            <mat-expansion-panel [expanded]="true" #panel1 hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img
                      src="assets/svgs/patient-interaction.svg"
                      alt=""
                      width="44px"
                    />
                    <h6 class="mb-0 ml-2">Patient interaction</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel1.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <form
                [formGroup]="patientInteractionForm"
                (ngSubmit)="savePatientInteraction()"
              >
                <ul class="items-list">
                  <li>
                    <div class="row">
                      <label class="col-sm-3 col-form-label"
                        >Connect with patient</label
                      >
                      <div
                        class="col-sm-9 d-flex align-items-center"
                        *ngIf="
                          getPersonAttributeValue('Telephone Number') != 'NA';
                          else noContactDetails
                        "
                      >
                        <div class="d-flex">
                          <a
                            href="tel:{{
                              getPersonAttributeValue('Telephone Number')
                            }}"
                            target="_blank"
                            class="icon-btn m-0 mr-2"
                          >
                            <img src="assets/svgs/phone-green.svg" alt="" />
                          </a>
                          <a
                            href="{{ getWhatsAppLink() }}"
                            target="_blank"
                            class="icon-btn m-0 mr-2"
                          >
                            <img src="assets/svgs/whatsapp-green.svg" alt="" />
                          </a>
                        </div>
                        <span class="text-muted"
                          >Click here to connent with the patient</span
                        >
                      </div>
                      <ng-template #noContactDetails>
                        <div class="col-sm-9 d-flex align-items-center">
                          <span class="text-muted"
                            >Patient Mobile number is not available</span
                          >
                        </div>
                      </ng-template>
                    </div>
                  </li>
                  <li *ngIf="!patientInteractionForm.value.present">
                    <div class="row">
                      <label class="col-sm-3 col-form-label"
                        >Have you spoken with the patient directly?</label
                      >
                      <div class="col-sm-9 d-flex align-items-center">
                        <div class="pretty p-default p-round">
                          <input
                            type="radio"
                            [value]="'Yes'"
                            formControlName="spoken"
                          />
                          <div class="state p-success">
                            <label>Yes</label>
                          </div>
                        </div>
                        <div class="pretty p-default p-round">
                          <input
                            type="radio"
                            [value]="'No'"
                            formControlName="spoken"
                          />
                          <div class="state p-success">
                            <label>No</label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
                <div
                  class="form-group mb-0"
                  *ngIf="
                    isVisitNoteProvider &&
                    !visitEnded &&
                    !patientInteractionForm.value.present
                  "
                >
                  <button
                    type="submit"
                    class="gray-btn"
                    [disabled]="patientInteractionForm.invalid"
                  >
                    Save
                  </button>
                </div>
                <div class="table-responsive" *ngIf="patientInteractionForm.value.present">
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Patient Interaction</th>
                        <th scope="col">Status</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Spoken with the patient directly?</td>
                        <td>{{ patientInteractionForm.value.spoken }}</td>
                        <td class="pr-0">
                          <button
                            type="button"
                            mat-icon-button
                            class="float-right"
                            *ngIf="isVisitNoteProvider && !visitEnded"
                            (click)="deletePatientInteraction()"
                          >
                            <img src="assets/svgs/delete-icon.svg" alt="" />
                          </button>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </form>
            </mat-expansion-panel>

            <mat-expansion-panel
              [expanded]="true"
              #panel2
              hideToggle
              class="bg-gray"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/diagnosis.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Diagnosis</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel2.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Diagnosis</th>
                      <th scope="col">Type</th>
                      <th scope="col">Status</th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <ng-container *ngIf="existingDiagnosis.length">
                      <tr *ngFor="let d of existingDiagnosis; let i = index">
                        <td>{{ d.diagnosisName }}</td>
                        <td>{{ d.diagnosisType }}</td>
                        <td>{{ d.diagnosisStatus }}</td>
                        <td class="pr-0">
                          <button
                            mat-icon-button
                            class="float-right"
                            *ngIf="isVisitNoteProvider && !visitEnded"
                            (click)="deleteDiagnosis(i, d.uuid)"
                          >
                            <img src="assets/svgs/delete-icon.svg" alt="" />
                          </button>
                        </td>
                      </tr>
                    </ng-container>
                    <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                      <tr *ngIf="addMoreDiagnosis">
                        <td colspan="4">
                          <div class="form-group mb-0">
                            <button
                              type="button"
                              class="add-more-btn"
                              (click)="toggleDiagnosis()"
                            >
                              <img src="assets/svgs/plus-circle.svg" alt="" />
                              <span class="ml-2">Add more diagnosis</span>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </div>

              <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                <form
                  [formGroup]="diagnosisForm"
                  (ngSubmit)="saveDiagnosis()"
                  *ngIf="!addMoreDiagnosis"
                >
                  <ul class="items-list">
                    <li>
                      <div class="row">
                        <label
                          for="select-diagnosis"
                          class="col-sm-3 col-form-label"
                          >Select diagnosis</label
                        >
                        <div class="col-sm-3">
                          <ng-select
                            class="visit-select custom"
                            formControlName="diagnosisName"
                            (search)="onKeyUp($event)"
                            [items]="diagnosis$ | async"
                            bindLabel="name"
                            bindValue="name"
                            [clearable]="true"
                            [searchable]="true"
                            placeholder="Select diagnosis"
                            [addTag]="true"
                          >
                          </ng-select>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="row">
                        <label class="col-sm-3 col-form-label"
                          >Diagnosis type</label
                        >
                        <div class="col-sm-9 d-flex align-items-center">
                          <div class="pretty p-default p-round">
                            <input
                              type="radio"
                              [value]="'Primary'"
                              formControlName="diagnosisType"
                            />
                            <div class="state p-success">
                              <label>Primary</label>
                            </div>
                          </div>
                          <div class="pretty p-default p-round">
                            <input
                              type="radio"
                              [value]="'Secondary'"
                              formControlName="diagnosisType"
                            />
                            <div class="state p-success">
                              <label>Secondary</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="row">
                        <label class="col-sm-3 col-form-label">Select</label>
                        <div class="col-sm-9 d-flex align-items-center">
                          <div class="pretty p-default p-round">
                            <input
                              type="radio"
                              [value]="'Provisional'"
                              formControlName="diagnosisStatus"
                            />
                            <div class="state p-success">
                              <label>Provisional</label>
                            </div>
                          </div>
                          <div class="pretty p-default p-round">
                            <input
                              type="radio"
                              [value]="'Confirmed'"
                              formControlName="diagnosisStatus"
                            />
                            <div class="state p-success">
                              <label>Confirmed</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>
                  </ul>
                  <div class="form-group mb-0">
                    <button
                      type="button"
                      class="white-btn mr-2"
                      (click)="toggleDiagnosis()"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      class="gray-btn"
                      [disabled]="diagnosisForm.invalid"
                    >
                      Add
                    </button>
                  </div>
                </form>
              </ng-container>

              <!-- <form [formGroup]="diagnosisForm" (ngSubmit)="saveDiagnosis()">
                <ul class="items-list">
                  <li>
                    <div class="row">
                      <label class="col-sm-3 col-form-label">Do you have enough information for diagnosis?</label>
                      <div class="col-sm-9 d-flex align-items-center">
                        <div class="pretty p-default p-round">
                          <input type="radio" [value]="'Yes'" formControlName="diagnosisIdentified" />
                          <div class="state p-success">
                            <label>Yes</label>
                          </div>
                        </div>
                        <div class="pretty p-default p-round">
                          <input type="radio" [value]="'No'" formControlName="diagnosisIdentified" />
                          <div class="state p-success">
                            <label>No</label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                  <ng-container *ngIf="diagnosisForm.value.diagnosisIdentified == 'Yes'">
                    <li>
                      <div class="row">
                        <label for="select-diagnosis" class="col-sm-3 col-form-label">Select diagnosis</label>
                        <div class="col-sm-3">
                          <ng-select class="visit-select custom" formControlName="diagnosisName" (search)="onKeyUp($event)" [items]="diagnosis$ | async" bindLabel="name" bindValue="name" [clearable]="true" [searchable]="true" placeholder="Select diagnosis" [addTag]="true">
                          </ng-select>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="row">
                        <label class="col-sm-3 col-form-label">Diagnosis type</label>
                        <div class="col-sm-9 d-flex align-items-center">
                          <div class="pretty p-default p-round">
                            <input type="radio" [value]="'Primary'" formControlName="diagnosisType" />
                            <div class="state p-success">
                              <label>Primary</label>
                            </div>
                          </div>
                          <div class="pretty p-default p-round">
                            <input type="radio" [value]="'Secondary'" formControlName="diagnosisType" />
                            <div class="state p-success">
                              <label>Secondary</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="row">
                        <label class="col-sm-3 col-form-label">Select</label>
                        <div class="col-sm-9 d-flex align-items-center">
                          <div class="pretty p-default p-round">
                            <input type="radio" [value]="'Provisional'" formControlName="diagnosisStatus" />
                            <div class="state p-success">
                              <label>Provisional</label>
                            </div>
                          </div>
                          <div class="pretty p-default p-round">
                            <input type="radio" [value]="'Confirmed'" formControlName="diagnosisStatus" />
                            <div class="state p-success">
                              <label>Confirmed</label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>
                  </ng-container>
                </ul>
                <div class="form-group mb-0" *ngIf="isVisitNoteProvider && !visitEnded && !diagnosisForm.value.present && diagnosisForm.value.diagnosisIdentified == 'Yes'">
                  <button type="submit" class="gray-btn" [disabled]="diagnosisForm.invalid">Save</button>
                </div>
              </form> -->
            </mat-expansion-panel>

            <mat-expansion-panel [expanded]="true" #panel3 hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/note.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Note</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel3.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <ul class="items-list" *ngIf="notes.length">
                <li *ngFor="let n of notes; let i = index">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <span>{{ n.value }}</span>
                    <button
                      mat-icon-button
                      (click)="deleteNote(i, n.uuid)"
                      *ngIf="isVisitNoteProvider && !visitEnded"
                    >
                      <img src="assets/svgs/delete-icon.svg" alt="" />
                    </button>
                  </div>
                </li>
              </ul>
              <ng-template #noNotes>
                <div class="no-docs text-center font-weight-bold">
                  No notes added!
                </div>
              </ng-template>
              <form
                class="mt-3"
                [formGroup]="addNoteForm"
                (ngSubmit)="addNote()"
                *ngIf="isVisitNoteProvider && !visitEnded"
              >
                <div class="form-group" *ngIf="addMoreNote">
                  <button
                    type="button"
                    class="add-more-btn"
                    (click)="toggleNote()"
                  >
                    <img src="assets/svgs/plus-circle.svg" alt="" />
                    <span class="ml-2">Add more notes</span>
                  </button>
                </div>
                <ng-container *ngIf="!addMoreNote">
                  <div class="form-group">
                    <label for="note"
                      ><b>Note&nbsp;</b>
                      <span class="text-muted"
                        >(Not shared with patient)</span
                      ></label
                    >
                    <textarea
                      class="form-control"
                      rows="3"
                      placeholder="Type here"
                      formControlName="note"
                    ></textarea>
                  </div>
                  <div class="form-group">
                    <button
                      type="button"
                      class="white-btn mr-2"
                      (click)="toggleNote()"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      class="gray-btn"
                      [disabled]="addNoteForm.invalid"
                    >
                      Add note
                    </button>
                  </div>
                </ng-container>
              </form>
            </mat-expansion-panel>

            <mat-expansion-panel
              [expanded]="true"
              #panel4
              hideToggle
              class="bg-gray overflow-show"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/medication.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Medication</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel4.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <form [formGroup]="addMedicineForm" (ngSubmit)="addMedicine()">
                <div class="table-responsive medication-con">
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Drug name</th>
                        <th scope="col">Strength</th>
                        <th scope="col">No. of days</th>
                        <th scope="col">Timing</th>
                        <th scope="col">Remarks</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngIf="medicines.length">
                        <tr *ngFor="let m of medicines; let i = index">
                          <td>{{ m.drug }}</td>
                          <td>{{ m.strength }}</td>
                          <td>{{ m.days }}</td>
                          <td>{{ m.timing }}</td>
                          <td>{{ m.remark }}</td>
                          <td class="pr-0">
                            <button
                              type="button"
                              mat-icon-button
                              class="float-right"
                              *ngIf="isVisitNoteProvider && !visitEnded"
                              (click)="deleteMedicine(i, m.uuid)"
                            >
                              <img src="assets/svgs/delete-icon.svg" alt="" />
                            </button>
                          </td>
                        </tr>
                      </ng-container>
                      <ng-template #noMedicines>
                        <tr>
                          <td colspan="6" class="text-center font-weight-bold">
                            No medicines added!
                          </td>
                        </tr>
                      </ng-template>
                      <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                        <tr *ngIf="addMoreMedicine">
                          <td colspan="6">
                            <div class="form-group mb-0">
                              <button
                                type="button"
                                class="add-more-btn"
                                (click)="toggleMedicine()"
                              >
                                <img src="assets/svgs/plus-circle.svg" alt="" />
                                <span class="ml-2">Add more medicine</span>
                              </button>
                            </div>
                          </td>
                        </tr>
                        <!-- <tr *ngIf="!addMoreMedicine">
                          <td>
                            <ng-select appendTo=".table-responsive" formControlName="drug" class="visit-select custom" [items]="drugNameList" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="true" [addTag]="true" placeholder="Select drug">
                            </ng-select>
                          </td>
                          <td>
                            <ng-select appendTo=".table-responsive"  formControlName="strength" class="visit-select custom" [items]="strengthList" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="true" [addTag]="true" placeholder="Select strength">
                            </ng-select>
                          </td>
                          <td>
                            <ng-select appendTo=".table-responsive"  formControlName="days" class="visit-select custom" [items]="daysList" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="true" [addTag]="true" placeholder="Select days">
                            </ng-select>
                          </td>
                          <td>
                            <ng-select appendTo=".table-responsive"  formControlName="timing" class="visit-select custom" [items]="timingList" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="true" [addTag]="true" placeholder="Select timing">
                            </ng-select>
                          </td>
                          <td colspan="2">
                            <div class="form-group mb-0">
                              <input formControlName="remark" type="text" class="form-control" placeholder="Enter Remark">
                            </div>
                          </td>
                        </tr> -->
                        <tr *ngIf="!addMoreMedicine">
                          <td>
                            <div class="form-group mb-0">
                              <input
                                formControlName="drug"
                                type="text"
                                class="form-control"
                                placeholder="Enter drug"
                                [ngbTypeahead]="search3"
                              />
                            </div>
                          </td>
                          <td>
                            <div class="form-group mb-0">
                              <input
                                formControlName="strength"
                                type="text"
                                class="form-control"
                                placeholder="Enter strength"
                                [ngbTypeahead]="search4"
                              />
                            </div>
                          </td>
                          <td>
                            <div class="form-group mb-0">
                              <input
                                formControlName="days"
                                type="text"
                                class="form-control"
                                placeholder="Enter days"
                                [ngbTypeahead]="search5"
                              />
                            </div>
                          </td>
                          <td>
                            <ng-select
                              appendTo=".medication-con"
                              formControlName="timing"
                              class="visit-select custom"
                              [items]="timingList"
                              bindLabel="name"
                              bindValue="name"
                              [clearable]="false"
                              [searchable]="true"
                              [addTag]="true"
                              placeholder="Select timing"
                            >
                            </ng-select>
                          </td>
                          <td colspan="2">
                            <div class="form-group mb-0">
                              <input
                                formControlName="remark"
                                type="text"
                                class="form-control"
                                placeholder="Enter Remark"
                              />
                            </div>
                          </td>
                        </tr>
                        <tr *ngIf="!addMoreMedicine">
                          <td colspan="6" class="border-top-0">
                            <div class="form-group mb-0 float-right">
                              <button
                                type="button"
                                class="white-btn mr-2"
                                (click)="toggleMedicine()"
                              >
                                Cancel
                              </button>
                              <button
                                type="submit"
                                class="gray-btn"
                                [disabled]="addMedicineForm.invalid"
                              >
                                Add
                              </button>
                            </div>
                          </td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div>
              </form>

              <h6 class="list-header mt-3 mb-2">Additional instructions</h6>
              <ng-container *ngIf="additionalInstructions.length">
                <ul class="items-list">
                  <li *ngFor="let ai of additionalInstructions; let i = index">
                    <div class="d-flex justify-content-between">
                      <span>{{ ai.value }}</span>
                      <button
                        mat-icon-button
                        *ngIf="isVisitNoteProvider && !visitEnded"
                        (click)="deleteAdditionalInstruction(i, ai.uuid)"
                      >
                        <img src="assets/svgs/delete-icon.svg" alt="" />
                      </button>
                    </div>
                  </li>
                </ul>
              </ng-container>

              <ng-template #noAdditionalInstructions>
                <div class="no-docs text-center font-weight-bold">
                  No additional instructions added!
                </div>
              </ng-template>
              <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                <div class="form-group" *ngIf="addMoreAdditionalInstruction">
                  <button
                    type="button"
                    class="add-more-btn"
                    (click)="toggleAdditionalInstruction()"
                  >
                    <img src="assets/svgs/plus-circle.svg" alt="" />
                    <span class="ml-2">Add more instructions</span>
                  </button>
                </div>
                <form
                  [formGroup]="addAdditionalInstructionForm"
                  (ngSubmit)="addAdditionalInstruction()"
                  *ngIf="!addMoreAdditionalInstruction"
                >
                  <div class="form-group">
                    <!-- <label for="note"><b>Additional instructions</b></label> -->
                    <textarea
                      formControlName="note"
                      class="form-control"
                      rows="3"
                      placeholder="Type here"
                    ></textarea>
                  </div>
                  <div class="form-group">
                    <button
                      type="button"
                      class="white-btn mr-2"
                      (click)="toggleAdditionalInstruction()"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      class="gray-btn"
                      [disabled]="addAdditionalInstructionForm.invalid"
                    >
                      Save
                    </button>
                  </div>
                </form>
              </ng-container>
            </mat-expansion-panel>

            <mat-expansion-panel
              [expanded]="true"
              #panel5
              hideToggle
              class="overflow-show"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/advice.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Advice</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel5.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <ul class="items-list" *ngIf="advices.length">
                <li *ngFor="let ad of advices; let i = index">
                  <div class="d-flex justify-content-between">
                    <span>{{ ad.value }}</span>
                    <button
                      mat-icon-button
                      (click)="deleteAdvice(i, ad.uuid)"
                      *ngIf="isVisitNoteProvider && !visitEnded"
                    >
                      <img src="assets/svgs/delete-icon.svg" alt="" />
                    </button>
                  </div>
                </li>
              </ul>
              <ng-template #noAdvices>
                <div class="no-docs text-center font-weight-bold">
                  No advices added!
                </div>
              </ng-template>
              <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                <div class="form-group mt-3" *ngIf="addMoreAdvice">
                  <button
                    type="button"
                    class="add-more-btn"
                    (click)="toggleAdvice()"
                  >
                    <img src="assets/svgs/plus-circle.svg" alt="" />
                    <span class="ml-2">Add more advice</span>
                  </button>
                </div>
                <form
                  class="mt-3"
                  [formGroup]="addAdviceForm"
                  (ngSubmit)="addAdvice()"
                  *ngIf="!addMoreAdvice"
                >
                  <div class="form-group">
                    <label for="note"><b>Advice</b></label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="advice"
                      placeholder="Type here"
                      [ngbTypeahead]="search"
                    />
                  </div>
                  <div class="form-group">
                    <button
                      type="button"
                      class="white-btn mr-2"
                      (click)="toggleAdvice()"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      class="gray-btn"
                      [disabled]="addAdviceForm.invalid"
                    >
                      Add advice
                    </button>
                  </div>
                </form>
              </ng-container>
            </mat-expansion-panel>

            <mat-expansion-panel
              [expanded]="true"
              #panel6
              hideToggle
              class="bg-gray overflow-show"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/test.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Test</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel6.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <ul class="items-list" *ngIf="tests.length">
                <li *ngFor="let t of tests; let i = index">
                  <div class="d-flex justify-content-between">
                    <span>{{ t.value }}</span>
                    <button
                      mat-icon-button
                      (click)="deleteTest(i, t.uuid)"
                      *ngIf="isVisitNoteProvider && !visitEnded"
                    >
                      <img src="assets/svgs/delete-icon.svg" alt="" />
                    </button>
                  </div>
                </li>
              </ul>
              <ng-template #noTests>
                <div class="no-docs text-center font-weight-bold">
                  No tests added!
                </div>
              </ng-template>
              <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                <div class="form-group mt-3" *ngIf="addMoreTest">
                  <button
                    type="button"
                    class="add-more-btn"
                    (click)="toggleTest()"
                  >
                    <img src="assets/svgs/plus-circle.svg" alt="" />
                    <span class="ml-2">Add more test</span>
                  </button>
                </div>
                <form
                  class="mt-3"
                  [formGroup]="addTestForm"
                  (ngSubmit)="addTest()"
                  *ngIf="!addMoreTest"
                >
                  <div class="form-group">
                    <label for="note"><b>Test</b></label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="test"
                      placeholder="Type here"
                      [ngbTypeahead]="search2"
                    />
                  </div>
                  <div class="form-group">
                    <button
                      type="button"
                      class="white-btn mr-2"
                      (click)="toggleTest()"
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      class="gray-btn"
                      [disabled]="addTestForm.invalid"
                    >
                      Add test
                    </button>
                  </div>
                </form>
              </ng-container>
            </mat-expansion-panel>

            <mat-expansion-panel
              [expanded]="true"
              #panel7
              hideToggle
              class="overflow-show"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/referral.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Referral</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel7.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <form [formGroup]="addReferralForm" (ngSubmit)="addReferral()">
                <div class="table-responsive scrollable-box">
                  <table class="table">
                    <thead>
                      <tr>
                        <th scope="col">Referral facility</th>
                        <th scope="col">Remarks</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <ng-container *ngIf="referrals.length">
                        <tr *ngFor="let r of referrals; let i = index">
                          <td>{{ r.speciality }}</td>
                          <td>{{ r.remark }}</td>
                          <td class="pr-0">
                            <button
                              type="button"
                              class="float-right"
                              mat-icon-button
                              (click)="deleteReferral(i, r.uuid)"
                              *ngIf="isVisitNoteProvider && !visitEnded"
                            >
                              <img src="assets/svgs/delete-icon.svg" alt="" />
                            </button>
                          </td>
                        </tr>
                      </ng-container>
                      <ng-template #noReferrals>
                        <tr>
                          <td colspan="3" class="text-center font-weight-bold">
                            No referrals added!
                          </td>
                        </tr>
                      </ng-template>
                      <ng-container *ngIf="isVisitNoteProvider && !visitEnded">
                        <tr *ngIf="addMoreReferral">
                          <td colspan="3">
                            <div class="form-group mb-0">
                              <button
                                type="button"
                                class="add-more-btn"
                                (click)="toggleReferral()"
                              >
                                <img src="assets/svgs/plus-circle.svg" alt="" />
                                <span class="ml-2">Add more referral</span>
                              </button>
                            </div>
                          </td>
                        </tr>
                        <tr *ngIf="!addMoreReferral">
                          <td>
                            <ng-select
                              class="visit-select"
                              appendTo=".scrollable-box"
                              formControlName="speciality"
                              [items]="specializations"
                              bindLabel="name"
                              bindValue="name"
                              [clearable]="false"
                              [searchable]="true"
                              [addTag]="true"
                              placeholder="Select specialization"
                            >
                            </ng-select>
                          </td>
                          <td colspan="2">
                            <div class="form-group mb-0">
                              <input
                                formControlName="remark"
                                type="text"
                                class="form-control"
                                placeholder="Type here"
                              />
                            </div>
                          </td>
                        </tr>
                        <tr *ngIf="!addMoreReferral">
                          <td colspan="3" class="border-top-0">
                            <div class="form-group mb-0 float-right">
                              <button
                                type="button"
                                class="white-btn mr-2"
                                (click)="toggleReferral()"
                              >
                                Cancel
                              </button>
                              <button
                                type="submit"
                                class="gray-btn"
                                [disabled]="addReferralForm.invalid"
                              >
                                Add
                              </button>
                            </div>
                          </td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div>
              </form>
            </mat-expansion-panel>

            <mat-expansion-panel
              [expanded]="true"
              #panel8
              hideToggle
              class="bg-gray"
            >
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <div class="intel-accordion-title">
                    <img src="assets/svgs/follow-up.svg" alt="" width="44px" />
                    <h6 class="mb-0 ml-2">Follow-up</h6>
                  </div>
                </mat-panel-title>
                <mat-icon>{{ panel8.expanded ? "remove" : "add" }}</mat-icon>
              </mat-expansion-panel-header>

              <form [formGroup]="followUpForm" (ngSubmit)="saveFollowUp()" *ngIf="!followUpForm.value.present">
                <ul class="items-list">
                  <li>
                    <div class="row">
                      <label for="follow-up" class="col-sm-3 col-form-label"
                        >Do you want to have follow up with the patient?</label
                      >
                      <div class="col-sm-9 d-flex align-items-center">
                        <div class="pretty p-default p-round">
                          <input
                            type="radio"
                            [value]="'Yes'"
                            formControlName="wantFollowUp"
                          />
                          <div class="state p-success">
                            <label>Yes</label>
                          </div>
                        </div>
                        <div class="pretty p-default p-round">
                          <input
                            type="radio"
                            [value]="'No'"
                            formControlName="wantFollowUp"
                          />
                          <div class="state p-success">
                            <label>No</label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                  <ng-container
                    *ngIf="followUpForm.value.wantFollowUp == 'Yes'"
                  >
                    <li>
                      <div class="row">
                        <label for="follow-date" class="col-sm-3 col-form-label"
                          >Select date</label
                        >
                        <div class="col-sm-3">
                          <!-- <input type="date" class="form-control" placeholder="Enter date" formControlName="followUpDate"> -->
                          <div class="input-group">
                            <input
                              type="text"
                              class="form-control"
                              formControlName="followUpDate"
                              [min]="minDate"
                              [matDatepicker]="fdp"
                              placeholder="Enter date"
                              aria-label="Birthdate"
                              aria-describedby="basic-addon1"
                              readonly
                            />
                            <mat-datepicker #fdp></mat-datepicker>
                            <div class="input-group-append">
                              <span class="input-group-text" id="basic-addon1">
                                <mat-datepicker-toggle matSuffix [for]="fdp">
                                  <img
                                    matDatepickerToggleIcon
                                    src="assets/svgs/calendar-date.svg"
                                    alt=""
                                  />
                                </mat-datepicker-toggle>
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="row">
                        <label for="follow-date" class="col-sm-3 col-form-label"
                          >Select time</label
                        >
                        <div class="col-sm-3">
                          <ng-select
                            class="visit-select custom"
                            appendTo="body"
                            formControlName="followUpTime"
                            [items]="timeList"
                            bindLabel="name"
                            [clearable]="false"
                            [searchable]="true"
                            placeholder="Select time"
                          >
                          </ng-select>
                        </div>
                      </div>
                    </li>
                    <li>
                      <div class="row">
                        <label
                          for="follow-reason"
                          class="col-sm-3 col-form-label"
                          >Reason for follow-up</label
                        >
                        <div class="col-sm-9">
                          <input
                            type="text"
                            class="form-control"
                            placeholder="Type here"
                            formControlName="followUpReason"
                          />
                        </div>
                      </div>
                    </li>
                  </ng-container>
                </ul>
                <div
                  class="form-group mb-0"
                  *ngIf="
                    isVisitNoteProvider &&
                    !visitEnded &&
                    !followUpForm.value.present &&
                    followUpForm.value.wantFollowUp == 'Yes'
                  "
                >
                  <button
                    type="submit"
                    class="gray-btn"
                    [disabled]="followUpForm.invalid"
                  >
                    Save
                  </button>
                </div>
              </form>

              <div class="table-responsive" *ngIf="followUpForm.value.present">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Follow Up Requested</th>
                      <th scope="col">Date</th>
                      <th scope="col">Time</th>
                      <th scope="col">Reason</th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>{{ followUpForm.value.wantFollowUp }}</td>
                      <td>{{ (followUpForm.value.followUpDate) ? (followUpForm.value.followUpDate|date:'dd MMMM yyyy') : '-' }}</td>
                      <td>{{ (followUpForm.value.followUpTime) ? followUpForm.value.followUpTime : '-' }}</td>
                      <td>{{ (followUpForm.value.followUpReason) ? followUpForm.value.followUpReason : '-' }}</td>
                      <td class="pr-0">
                        <button
                          type="button"
                          class="float-right"
                          mat-icon-button
                          (click)="deleteFollowUp()"
                          *ngIf="isVisitNoteProvider && !visitEnded"
                        >
                          <img src="assets/svgs/delete-icon.svg" alt="" />
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </mat-expansion-panel>
          </mat-accordion>
        </div>
      </div>
    </div>

    <div class="col-md-12 p-0 py-2 mb-5 text-center">
      <button
        type="button"
        class="blue-btn mr-2"
        (click)="sharePrescription()"
        *ngIf="visitNotePresent && !visitEnded && isVisitNoteProvider"
      >
        {{ visitCompleted ? 'Update': 'Share' }} prescription
      </button>
      <button
        type="button"
        class="blue-btn"
        (click)="openVisitPrescriptionModal(visit?.uuid)"
        *ngIf="visitNotePresent && visitCompleted"
        >
        View prescription
      </button>
    </div>
  </div>
</div>

<div class="webrtc-controls">
  <img class="img shadow" src="assets/svgs/video-frame.svg" (click)="startCall()"/>
  <img class="img shadow" src="assets/svgs/chat-icon-blue-circle.svg" (click)="startChat()"/>
</div>
