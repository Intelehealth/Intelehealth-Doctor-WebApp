<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 p-1">
      <div class="user-profile-con">
        <div class="profile-pic-con">
          <div class="profile-pic">
            <img [src]="profilePicUrl" (error)="onImgError($event)" alt="" width="80px" height="80px">
            <div class="file-input-con">
              <label for="profile-pic">
                <img src="assets/svgs/camera.svg" alt="">
              </label>
              <input id="profile-pic" type="file" accept="image/jpg" (change)="preview($event)">
            </div>
          </div>
        </div>
        <div class="profile-content">
          <h6>{{doctorName|titlecase}}</h6>
          <p>Username: {{user?.display}}</p>
        </div>
      </div>
    </div>
    <div class="col-md-9 p-1">
      <div class="intel-card">
        <mat-stepper linear #stepper [disableRipple]="true" (selectionChange)="stepChanged($event)">
          <mat-step>
            <ng-template matStepLabel>
              <div class="custom-step-label">
                <span class="label-index">1</span>
                Personal Information
              </div>
            </ng-template>
            <form [formGroup]="personalInfoForm" (ngSubmit)="goToNextStep()">
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="givenName">First name *</label>
                  <input type="text" class="form-control" formControlName="givenName" placeholder="Enter first name">
                  <div *ngIf="submitted && f1.givenName.errors">
                    <small class="error-msg" *ngIf="f1.givenName.errors.required">Enter first name</small>
                    <small class="error-msg" *ngIf="f1.givenName.errors.pattern">Enter alphabates only</small>
                  </div>
                </div>
                <div class="form-group col-md-4">
                  <label for="middleName">Middle name *</label>
                  <input type="text" class="form-control" formControlName="middleName" placeholder="Enter middle name">
                  <div *ngIf="submitted && f1.middleName.errors">
                    <small class="error-msg" *ngIf="f1.middleName.errors.required">Enter middle name</small>
                    <small class="error-msg" *ngIf="f1.middleName.errors.pattern">Enter alphabates only</small>
                  </div>
                </div>
                <div class="form-group col-md-4">
                  <label for="familyName">Last name *</label>
                  <input type="text" class="form-control" formControlName="familyName" placeholder="Enter last name">
                  <div *ngIf="submitted && f1.familyName.errors">
                    <small class="error-msg" *ngIf="f1.familyName.errors.required">Enter last name</small>
                    <small class="error-msg" *ngIf="f1.familyName.errors.pattern">Enter alphabates only</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="gender">Gender *</label>
                  <div class="py-2">
                    <div class="pretty p-default p-round">
                      <input type="radio" value="M"  formControlName="gender">
                      <div class="state p-success">
                          <label>Male</label>
                      </div>
                      </div>
                      <div class="pretty p-default p-round">
                          <input type="radio" value="F"  formControlName="gender">
                          <div class="state p-success">
                              <label>Female</label>
                          </div>
                      </div>
                      <div class="pretty p-default p-round">
                          <input type="radio" value="U"  formControlName="gender">
                          <div class="state p-success">
                              <label>Other</label>
                          </div>
                      </div>
                  </div>
                </div>
                <div class="form-group col-md-4">
                  <label for="birthdate">Date of birth *</label>
                  <div class="input-group">
                    <input type="text" class="form-control" formControlName="birthdate" [matDatepicker]="dobdp" placeholder="Enter DOB" aria-label="Birthdate"
                      aria-describedby="basic-addon1" readonly>
                    <mat-datepicker #dobdp></mat-datepicker>
                    <div class="input-group-append">
                      <span class="input-group-text" id="basic-addon1">
                        <mat-datepicker-toggle matSuffix [for]="dobdp">
                          <img matDatepickerToggleIcon src="assets/svgs/calendar-date.svg" alt="">
                        </mat-datepicker-toggle>
                      </span>
                    </div>
                  </div>
                  <div *ngIf="submitted && f1.birthdate.errors">
                    <small class="error-msg" *ngIf="f1.birthdate.errors.required">Enter DOB</small>
                  </div>
                </div>
                <div class="form-group col-md-2">
                  <label for="age">Age *</label>
                  <input type="number" class="form-control" formControlName="age" placeholder="Enter age">
                  <div *ngIf="submitted && f1.age.errors">
                    <small class="error-msg" *ngIf="f1.age.errors.required">Enter age</small>
                    <small class="error-msg" *ngIf="f1.age.errors.pattern">Enter numeric value only</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="phoneNumber">Phone Number *</label>
                  <input type="number"
                    ng2TelInput
                    [ng2TelInputOptions]="{initialCountry: 'in', separateDialCode: true, autoHideDialCode: false}"
                    (hasError)="hasError($event, 'phoneNumber')"
                    (ng2TelOutput)="getNumber($event, 'phoneNumber')"
                    (intlTelInputObject)="telInputObject($event, 'phoneNumber')"
                    (countryChange)="onCountryChange($event, 'phoneNumber')"
                    placeholder="Enter Mobile Number"
                    class="form-control"
                    formControlName="phoneNumber"/>
                  <div *ngIf="submitted && f1.phoneNumber.errors">
                    <small class="error-msg" *ngIf="f1.phoneNumber.errors.required">Enter phone number</small>
                  </div>
                  <div *ngIf="submitted && !f1.phoneNumber.errors && !phoneNumberValid">
                    <small class="error-msg">Enter valid phone number</small>
                  </div>
                </div>
                <div class="form-group col-md-6">
                  <label for="whatsapp">WhatsApp Number *</label>
                  <input type="number"
                    ng2TelInput
                    [ng2TelInputOptions]="{initialCountry: 'in', separateDialCode: true, autoHideDialCode: false}"
                    (hasError)="hasError($event, 'whatsAppNumber')"
                    (ng2TelOutput)="getNumber($event, 'whatsAppNumber')"
                    (intlTelInputObject)="telInputObject($event, 'whatsAppNumber')"
                    (countryChange)="onCountryChange($event, 'whatsAppNumber')"
                    placeholder="Enter Mobile Number"
                    class="form-control"
                    formControlName="whatsapp"/>
                  <div *ngIf="submitted && f1.whatsapp.errors">
                    <small class="error-msg" *ngIf="f1.whatsapp.errors.required">Enter whatsApp number</small>
                  </div>
                  <div *ngIf="submitted && !f1.whatsapp.errors && !whatsAppNumberValid">
                    <small class="error-msg">Enter valid whatsApp number</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="emailId">Email ID *</label>
                  <input type="email" class="form-control" formControlName="emailId" placeholder="Enter email">
                  <div *ngIf="submitted && f1.emailId.errors">
                    <small class="error-msg" *ngIf="f1.emailId.errors.required">Enter email</small>
                    <small class="error-msg" *ngIf="f1.emailId.errors.pattern">Enter valid email</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="col-md-12">
                  <h6>Add signature</h6>
                  <mat-tab-group class="signature-tab-group" mat-align-tabs="start" [selectedIndex]="selectedSignatureTabIndex" (selectedTabChange)="signatureTabChanged($event)">
                    <mat-tab label="Draw">
                      <div class="container">
                        <div class="form-row">
                          <div class="form-group col-md-12">
                            <label for="drawSignature">Draw signature * <span class="link"><a (click)="clearSignature()">clear sign</a></span></label>
                          </div>
                          <div class="col-md-12" id="signature-container">
                            <signature-pad [options]="signaturePadOptions" (onBeginEvent)="drawStart()" (onEndEvent)="drawComplete()"></signature-pad>
                          </div>
                        </div>
                      </div>
                    </mat-tab>

                    <mat-tab label="Generate">
                      <div class="container">
                        <div class="form-row">
                          <div class="form-group col-md-6">
                            <label for="textOfSign">Signature letters *</label>
                            <input type="text" class="form-control" placeholder="Enter signature letters" formControlName="textOfSign">
                            <div *ngIf="submitted && f1.textOfSign.errors">
                              <small class="error-msg" *ngIf="f1.textOfSign.errors.required">Enter signature letters</small>
                            </div>
                          </div>
                          <div class="form-group col-md-6">
                            <label for="fontOfSign">Select Signature *</label>
                            <ng-select class="profile-select" [items]="fonts" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="false" placeholder="Select Signature" formControlName="fontOfSign">
                              <ng-template ng-label-tmp let-item="item">
                                <p class="mb-0" [style.fontFamily]="item.name" style="font-size: 50px;">{{item.text}}</p>
                              </ng-template>
                              <ng-template ng-option-tmp let-item="item" let-index="index">
                                <p class="mb-0" [style.fontFamily]="item.name" style="font-size: 50px;">{{item.text}}</p>
                              </ng-template>
                            </ng-select>
                            <div *ngIf="submitted && f1.fontOfSign.errors">
                              <small class="error-msg" *ngIf="f1.fontOfSign.errors.required">Select Signature</small>
                            </div>
                          </div>
                        </div>
                      </div>
                    </mat-tab>

                    <mat-tab label="Upload">
                      <ng-container *ngIf="!signatureFile; else signaturePreview">
                        <ngx-dropzone #drop [expandable]="true" [disableClick]="false" [multiple]="false" accept="image/png,image/jpg,image/jpeg" [maxFileSize]="50000" (change)="onFilesDropped($event)"></ngx-dropzone>
                        <div class="dropzone d-flex justify-content-center align-items-center" (click)="drop.showFileSelector()">
                          <img src="assets/svgs/add-btn-blue-square.svg" alt="" width="48px" height="48px">
                          <p class="ml-2">Upload a scanned image of your signature.<br> Image size (5kb to 50kb)</p>
                        </div>
                      </ng-container>
                      <ng-template #signaturePreview>
                        <div class="dropzone d-flex justify-content-center align-items-center">
                          <img [src]="signaturePicUrl" alt="" width="100%" height="80px">
                          <button mat-icon-button (click)="reset()">
                            <mat-icon>close</mat-icon>
                          </button>
                        </div>
                      </ng-template>
                    </mat-tab>
                  </mat-tab-group>
                  <p>
                    By signing this document with an electronic signature, I agree that such signature will be as valid as handwritten signatures to the extent allowed by local law.
                  </p>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-12 text-right">
                  <button type="submit" class="btn next-btn">
                    Next
                    <img class="btn-icon" src="assets/svgs/right-arrow.svg" alt="">
                  </button>
                </div>
              </div>
            </form>
          </mat-step>

          <mat-step>
            <ng-template matStepLabel>
              <div class="custom-step-label">
                <span class="label-index">2</span>
                Professional Information
              </div>
            </ng-template>
            <form [formGroup]="professionalInfoForm" (ngSubmit)="updateProfile()">
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="typeOfProfession">Type of profession *</label>
                  <ng-select class="profile-select" [items]="professions" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="false"  formControlName="typeOfProfession" placeholder="Select type of profession">
                  </ng-select>
                  <div *ngIf="submitted && f2.typeOfProfession.errors">
                    <small class="error-msg" *ngIf="f2.typeOfProfession.errors.required">Select type of profession</small>
                  </div>
                </div>
                <div class="form-group col-md-6">
                  <label for="registrationNumber">Registration Number *</label>
                  <input type="text" class="form-control" formControlName="registrationNumber" placeholder="Enter registration number">
                  <div *ngIf="submitted && f2.registrationNumber.errors">
                    <small class="error-msg" *ngIf="f2.registrationNumber.errors.required">Enter registration number</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="specialization">Specialization *</label>
                  <ng-select class="profile-select" [items]="specializations" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="false" formControlName="specialization" placeholder="Select specialization">
                  </ng-select>
                  <div *ngIf="submitted && f2.specialization.errors">
                    <small class="error-msg" *ngIf="f2.specialization.errors.required">Select specialization</small>
                  </div>
                </div>
                <div class="form-group col-md-6">
                  <label for="consultationLanguage">Consultation Language *</label>
                  <ng-select class="profile-select" [items]="languages" [closeOnSelect]="false" [clearable]="false" [multiple]="true" [searchable]="false" bindLabel="name" bindValue="name" formControlName="consultationLanguage" placeholder="Select consultation language">
                    <ng-template ng-label-tmp let-item="item">
                      {{item.name}},
                    </ng-template>
                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                      <div class="pretty p-image p-plain">
                        <input type="checkbox" [checked]="item$.selected"/>
                        <div class="state">
                            <img class="image" src="assets/svgs/checkbox-tick.png">
                            <label>{{item.name}}</label>
                        </div>
                      </div>
                    </ng-template>
                  </ng-select>
                  <div *ngIf="submitted && f2.consultationLanguage.errors">
                    <small class="error-msg" *ngIf="f2.consultationLanguage.errors.required">Select consultation language</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="workExperience">Work Experience*</label>
                  <ng-select class="profile-select" [items]="specializations" bindLabel="name" bindValue="name" [clearable]="false" [searchable]="false" formControlName="workExperience" placeholder="Eg. General Physician">
                  </ng-select>
                  <div *ngIf="submitted && f2.workExperience.errors">
                    <small class="error-msg" *ngIf="f2.workExperience.errors.required">Select work experience as</small>
                  </div>
                </div>
                <div class="form-group col-md-6">
                  <label for="researchExperience">Research Experience *</label>
                  <ng-select class="profile-select" [items]="languages" [closeOnSelect]="false" [clearable]="false" [multiple]="true" [searchable]="false" bindLabel="name" bindValue="name" formControlName="researchExperience" placeholder="Select research experience">
                    <ng-template ng-label-tmp let-item="item">
                      {{item.name}},
                    </ng-template>
                    <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                      <div class="pretty p-image p-plain">
                        <input type="checkbox" [checked]="item$.selected"/>
                        <div class="state">
                            <img class="image" src="assets/svgs/checkbox-tick.png">
                            <label>{{item.name}}</label>
                        </div>
                      </div>
                    </ng-template>
                  </ng-select>
                  <div *ngIf="submitted && f2.researchExperience.errors">
                    <small class="error-msg" *ngIf="f2.researchExperience.errors.required">Select research experience</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-12">
                  <label for="workExperienceDetails">Work Experience Details*</label>
                  <textarea class="form-control" rows="3" formControlName="workExperienceDetails" placeholder="Type here"></textarea>
                  <div *ngIf="submitted && f2.workExperienceDetails.errors">
                    <small class="error-msg" *ngIf="f2.workExperienceDetails.errors.required">Enter experience</small>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <button type="button" class="btn back-btn" matStepperPrevious>
                    Back
                    <img class="btn-icon" src="assets/svgs/left-arrow-blue.svg" alt="">
                  </button>
                </div>
                <div class="form-group col-md-6 text-right">
                  <button type="submit" class="btn next-btn">
                    Save
                  </button>
                </div>
              </div>
            </form>
          </mat-step>
        </mat-stepper>
      </div>
    </div>
  </div>
</div>
