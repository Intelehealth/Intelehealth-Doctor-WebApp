<div [ngClass]="getLang() === 'ar' ? 'class1' : 'class2'">
  <h4><i class="fas fa-pills"></i> {{'Prescribed Medication'|translate}}</h4>
  <hr>
  <div>
    <form [formGroup]="medForm">
      <!-- <mat-form-field class="w-100" id="medication-form">
        <input matInput placeholder="{{'Medication'|translate}}" (keydown)="add = true"
          [ngbTypeahead]="searchPrescription" formControlName="med" (selectItem)="onSelectMedicine($event)">
      </mat-form-field> -->
      <ng-select
        class="visit-select custom"
        formControlName="medObj"
        bindLabel="name"
        [clearable]="false"
        [searchable]="true"
        placeholder="{{'Medication'|translate}}"
        [editableSearchTerm]="true"
        [addTag]="true"
        addTagText="{{'Add item'|translate}}">
        <ng-option *ngFor="let m of autoFillMedicines" [value]="m">
          {{m.name}} {{m.strength}} {{m.strengthUnit}}
        </ng-option>
        <ng-template ng-label-tmp let-item="item">
          {{item.name ? item.name : item.label }}
        </ng-template>
      </ng-select>
      <div>
        <div class="form-row">
          <div class="col">
            <!-- <input type="text" class="form-control" [ngbTypeahead]="searchDose"
              placeholder="{{'Form'|translate}}" formControlName="unit"> -->
              <ng-select
                class="visit-select custom"
                formControlName="form"
                bindLabel="name"
                bindValue="name"
                [clearable]="false"
                [searchable]="true"
                placeholder="{{'Form'|translate}}"
                [addTag]="addStrengthTag.bind(this)"
                addTagText="{{'Add item'|translate}}">
                <ng-option *ngFor="let s of formList" [value]="s.name">
                  {{s.name}}
                </ng-option>
              </ng-select>
          </div>
          <div class="col">
            <mat-form-field class="w-100" id="medication-form">
              <input matInput class="in-put" type="number" min="0" step="0.01" pattern="^\d+(?:\.\d{1,2})?$" placeholder="{{'Strength'|translate}}" formControlName="dose">
            </mat-form-field>
            <!-- <input matInput type="number" min="0" step="0.01" pattern="^\d+(?:\.\d{1,2})?$" class="form-control"
              placeholder="{{'Strength'|translate}}" formControlName="dose"> -->
          </div>
          <div class="col">
            <!-- <input type="text" class="form-control" [ngbTypeahead]="searchDose"
              placeholder="{{'Units (eg: mg)'|translate}}" formControlName="unit"> -->
              <ng-select
                class="visit-select custom"
                formControlName="unit"
                bindLabel="name"
                bindValue="name"
                [clearable]="false"
                [searchable]="true"
                placeholder="{{'Strength unit'|translate}}"
                [addTag]="addStrengthTag.bind(this)"
                addTagText="{{'Add item'|translate}}">
                <ng-option *ngFor="let s of strengthList" [value]="s.name">
                  {{s.name}}
                </ng-option>
              </ng-select>
          </div>
          <div class="col">
            <mat-form-field class="w-100" id="medication-form">
              <input matInput class="in-put" type="number" min="1" placeholder="{{'Dose'|translate}}" formControlName="amount">
            </mat-form-field>
            <!-- <input type="text" class="form-control" [ngbTypeahead]="searchDose"
              placeholder="{{'Unit ( pill,  capsule, etc...)'|translate}}" formControlName="unitType"> -->
          </div>
          <div class="col">
            <!-- <input type="text" class="form-control" [ngbTypeahead]="searchDose"
              placeholder="{{'Unit ( pill,  capsule, etc...)'|translate}}" formControlName="unitType"> -->
              <ng-select
                class="visit-select custom"
                formControlName="unitType"
                bindLabel="name"
                bindValue="name"
                [clearable]="false"
                [searchable]="true"
                placeholder="{{'Dose unit'|translate}}"
                [addTag]="addStrengthTag.bind(this)"
                addTagText="{{'Add item'|translate}}">
                <ng-option *ngFor="let s of doseUnit" [value]="s.name">
                  {{s.name}}
                </ng-option>
              </ng-select>
          </div>
          <div class="col">
            <!-- <input type="text" class="form-control" [ngbTypeahead]="searchFrequency"
              placeholder="{{'Frequency'| translate}}" formControlName="frequency"> -->
              <ng-select
                class="visit-select custom"
                formControlName="frequency"
                bindLabel="name"
                bindValue="name"
                [clearable]="false"
                [searchable]="true"
                placeholder="{{'Frequency'| translate}}"
                [addTag]="addStrengthTag.bind(this)"
                addTagText="{{'Add item'|translate}}">
                <ng-option *ngFor="let s of frequencyList" [value]="s.name">
                  {{s.name}}
                </ng-option>
              </ng-select>
          </div>
        </div>
        <br>
        <!-- <div>{{'As needed'|translate}}</div> -->
        <div class="form-row">
          <div class="col">
            <!-- <input type="text" class="form-control" [ngbTypeahead]="searchAdministration"
              placeholder="{{'Route'|translate}}" formControlName="route"> -->
              <ng-select
                class="visit-select custom"
                formControlName="route"
                bindLabel="name"
                bindValue="name"
                [clearable]="false"
                [searchable]="true"
                placeholder="{{'Route'|translate}}"
                [addTag]="addStrengthTag.bind(this)"
                addTagText="{{'Add item'|translate}}">
                <ng-option *ngFor="let s of routeList" [value]="s.name">
                  {{s.name}}
                </ng-option>
              </ng-select>
          </div>
          <div class="col">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">{{'Duration'|translate}}</span>
              <input type="number" min="1" class="form-control" placeholder="{{'Duration' | translate}}"
                formControlName="duration">
            </div>
          </div>
          <div class="col">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">{{'Time unit'|translate}}</span>
              <input type="text" class="form-control" [ngbTypeahead]="durationUnit"
                placeholder="{{'Days/Weeks/etc.'|translate}}" formControlName="durationUnit">
              <!-- <span class="input-group-text" id="basic-addon1">{{'total'|translate}}</span> -->
            </div>
          </div>
          <div class="col">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon3">{{'Reason'|translate}}</span>
              <input type="text" class="form-control" placeholder="{{'reason(optional)'|translate}}"
              formControlName="reason">
            </div>
          </div>
        </div>
        <br>
        <textarea class="form-control" placeholder="{{'Additional instruction not covered above'|translate}}"
          formControlName="additional"></textarea>
        <br>
        <table class="table table-borderless table-sm">
          <tbody>
              <tr>
                  <th class="tr-label" scope="row">{{'Smallest package'|translate}}:</th>
                  <td><input type="text" class="form-controls" placeholder="{{'Smallest package'|translate}}" formControlName="smallestPackage"></td>
              </tr>
              <tr>
                  <th class="tr-label" scope="row">{{'Count Of packages'|translate}}:</th>
                  <td><input type="text" class="form-controls" placeholder="{{'Count Of packages'|translate}}" formControlName="countOfPackages"></td>
              </tr>
              <tr>
                  <th class="tr-label" scope="row">{{'Price'|translate}}:</th>
                  <td><input type="text" class="form-controls" placeholder="{{'Price'|translate}}" formControlName="price"></td>
              </tr>
          </tbody>
        </table>
        <button type="reset" (click)="onSubmit()" mat-raised-button color="primary" [disabled]='!medForm.valid || isManagerRole' *ngIf="!visitCompleted">{{'Add Meds'|translate}}</button>
      </div>
    </form>
    <br>
  </div>
  <ng-container *ngIf="meds.length > 0">
      <div *ngFor='let meds of meds, index as i' >
        <div [@moveInLeft] class="alert" [ngClass]="{ 'alert-primary': !meds.comment, 'alert-danger': meds.comment, 'light-gray': meds.disabled }">
          <div class="doctor-value d-flex flex-column">
            <span [class.strike]="meds.comment" [innerHTML]="meds.value.replace('\n','<br>').replace(':','')"></span>
            <div class="mt-2 d-flex flex-column border-top border-primary pt-2">
              <span class="comment-blue" *ngIf="isShow[i]">{{meds|comment:'addedBy-creator'}} {{meds.creatorRegNo}} | {{meds.obsDatetime|date:'dd-MM-y , hh:mm a'}}</span>
              <div *ngFor="let mds of medicineObsList">
                <div *ngFor="let med of mds[objectKeys(mds)]">
                  <span class="comment-blue" *ngIf="objectKeys(mds) == meds.value && objectKeys(med[0]) == 'dispensed' && isShow[i]">{{ ('Dispensed by'|translate)+' : '+med[0].dispensed}}  | {{med[1]|date:'dd-MM-y ,hh:mm a'}}</span>
                  <span class="comment-blue" *ngIf="objectKeys(mds) == meds.value && objectKeys(med[0]) == 'administered' && isShow[i]">{{ ('Administered by'|translate)+' : '+med[0].administered}}  | {{med[1]|date:'dd-MM-y ,hh:mm a'}}</span>
                </div>
              </div>
              <div><span *ngIf="meds.comment && isShow[i]" class="comment">{{meds.comment|comment}}</span></div>
            </div>
            <span *ngIf="isShow[i]" class="isShow" (click)="toggleShow(i)">{{'Hide Details'|translate}}</span>
            <span *ngIf="!isShow[i]" class="isShow" (click)="toggleShow(i)">{{'Show Details'|translate}}</span>
          </div>
          <i (click)="delete(i)" class="material-icons float-right" [class.disabled]="isManagerRole" *ngIf="!meds.comment && !visitCompleted && !meds.disabled" style="color:rgb(235, 30, 30);cursor: pointer;">delete</i>
      </div>
    </div>
  </ng-container>
  <ng-container *ngIf="tempMedicationDisplay.length > 0">
    <div *ngFor='let meds of tempMedicationDisplay, index as i' >
      <div [@moveInLeft] class="alert" [ngClass]="{ 'alert-primary': !meds.comment, 'alert-danger': meds.comment, 'light-gray': meds.disabled }">
        <div class="doctor-value d-flex flex-column">
          <span [class.strike]="meds.comment" [innerHTML]="meds.value.replace('\n','<br>').replace(':','')"></span>
          <div class="mt-2 d-flex flex-column border-top border-primary pt-2">
            <span class="comment-blue" *ngIf="isShow[i]">{{meds|comment:'addedBy-creator'}} {{meds.creatorRegNo}} | {{meds.obsDatetime|date:'dd-MM-y , hh:mm a'}}</span>
            <div *ngFor="let mds of medicineObsList">
              <div *ngFor="let med of mds[objectKeys(mds)]">
                <span class="comment-blue" *ngIf="objectKeys(mds) == meds.value && objectKeys(med[0]) == 'dispensed' && isShow[i]">{{ ('Dispensed by'|translate)+' : '+med[0].dispensed}}  | {{med[1]|date:'dd-MM-y ,hh:mm a'}}</span>
                <span class="comment-blue" *ngIf="objectKeys(mds) == meds.value && objectKeys(med[0]) == 'administered' && isShow[i]">{{ ('Administered by'|translate)+' : '+med[0].administered}}  | {{med[1]|date:'dd-MM-y ,hh:mm a'}}</span>
              </div>
            </div>
            <div><span *ngIf="meds.comment && isShow[i]" class="comment">{{meds.comment|comment}}</span></div>
          </div>
          <span *ngIf="isShow[i]" class="isShow" (click)="toggleShow(i)">{{'Hide Details'|translate}}</span>
          <span *ngIf="!isShow[i]" class="isShow" (click)="toggleShow(i)">{{'Show Details'|translate}}</span>
        </div>
        <i (click)="tempDelete(i)" class="material-icons float-right" [class.disabled]="isManagerRole" *ngIf="!meds.comment && !visitCompleted && !meds.disabled" style="color:rgb(235, 30, 30);cursor: pointer;">delete</i>
    </div>
  </div>
</ng-container>
</div>
